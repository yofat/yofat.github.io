---
layout: default
title: 分類
permalink: /categories.html
---

<div class="post-layout">
  <!-- 左側目錄 -->
  <nav class="post-toc" id="post-toc">
    <div class="toc-toggle" onclick="toggleTOC()">
      <i id="toc-icon">☰</i>
    </div>
    <div class="toc-header">
      <h3>分類導航</h3>
    </div>
    <div class="toc-content">
      <div id="categories-toc">
        {% for big in site.data.categories %}
          {% assign bigcat = big[0] %}
          <a href="#{{ bigcat }}" class="toc-link" data-level="1">{{ bigcat }}</a>
          {% for small in big[1] %}
            <a href="#{{ small }}" class="toc-link" data-level="2">{{ small }}</a>
          {% endfor %}
        {% endfor %}
      </div>
    </div>
  </nav>

  <!-- 主要內容 -->
  <main class="post-main">
    <div class="post-header">
      <h1>分類</h1>
      <div class="post-meta">
        <span>📁 探索所有文章分類</span>
      </div>
    </div>

    <div class="post-content">
      {% comment %}
      根據 _data/categories.yml 的結構，列出每個大類與小類
      文章 frontmatter 用 categories: [大類, 小類]
      {% endcomment %}

      {% for big in site.data.categories %}
        {% assign bigcat = big[0] %}
        <section class="category-section">
          <h2 id="{{ bigcat }}">{{ bigcat }}</h2>
          {% for small in big[1] %}
            <div class="category-group">
              <h3 id="{{ small }}">{{ small }}</h3>
              <div class="posts-grid">
                {% assign posts_in_big = site.posts | where_exp: "p", "p.categories contains bigcat" %}
                {% assign posts_in_small = posts_in_big | where_exp: "p", "p.categories contains small" %}
                {% if posts_in_small.size == 0 %}
                  <div class="empty-notice">
                    <em>🔍 尚無文章，期待您的貢獻！</em>
                  </div>
                {% else %}
                  {% for p in posts_in_small %}
                    <article class="post-card">
                      <div class="post-card-content">
                        <h4><a href="{{ p.url | relative_url }}">{{ p.title }}</a></h4>
                        <div class="post-card-meta">
                          <span class="post-date">{{ p.date | date: "%Y-%m-%d" }}</span>
                          {% if p.excerpt %}
                            <p class="post-excerpt">{{ p.excerpt | strip_html | truncatewords: 15 }}</p>
                          {% endif %}
                        </div>
                      </div>
                    </article>
                  {% endfor %}
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </section>
      {% endfor %}

      <div class="back-nav">
        <a href="{{ '/' | relative_url }}" class="back-link">← 返回首頁</a>
      </div>
    </div>
  </main>

  <!-- 右側邊欄 -->
  <aside class="post-sidebar">
    <div class="sidebar-section">
      <h4>統計資訊</h4>
      <div class="categories-stats">
        <p>📊 總分類數：{{ site.data.categories.size }}</p>
        <p>📝 總文章數：{{ site.posts.size }}</p>
      </div>
    </div>
  </aside>
</div>

<!-- TOC 功能 -->
<script>
// TOC 收起/展開功能 (全域函式)
function toggleTOC() {
  const toc = document.getElementById('post-toc');
  const icon = document.getElementById('toc-icon');
  
  if (!toc || !icon) return;
  
  if (toc.classList.contains('collapsed')) {
    toc.classList.remove('collapsed');
    icon.textContent = '☰';
  } else {
    toc.classList.add('collapsed');
    icon.textContent = '▶';
  }
}

// 響應式檢查
function checkScreenWidth() {
  const toc = document.getElementById('post-toc');
  if (window.innerWidth < 1024 && toc) {
    toc.classList.add('collapsed');
    const icon = document.getElementById('toc-icon');
    if (icon) icon.textContent = '▶';
  }
}

// 初始化
document.addEventListener('DOMContentLoaded', function() {
  checkScreenWidth();
  window.addEventListener('resize', checkScreenWidth);
  
  // TOC 鏈接點擊平滑滾動
  document.querySelectorAll('#categories-toc a').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });
});
</script>
