---
layout: default
classes: home
---

{%- comment -%}
先計算字數（無需 plugin）：去 HTML、壓空白、split 空白，再取 size
{%- endcomment -%}
{% assign words = page.content | strip_html | normalize_whitespace | split: ' ' %}

<div class="grid-3col content-root">
  <!-- 左欄：TOC 目錄 -->
  <aside class="toc">
    <h3>目錄</h3>
    <nav id="toc">
      <!-- JavaScript 會動態生成目錄 -->
    </nav>
  </aside>

  <!-- 中欄：主要內容 -->
  <div class="maincol">
    <article class="post-article" data-count-key="post:{{ page.id | replace: '/', ':' }}">
    <header class="post-header">
      <h1>{{ page.title }}</h1>
      <div class="post-meta">
        <span class="post-date">📅 {{ page.date | date: "%Y-%m-%d" }}</span>

        {% if page.categories %}
          <span class="post-categories">
            📁 分類：
            {% for c in page.categories %}
              <a href="{{ '/categories.html#' | append: c | relative_url }}">{{ c }}</a>{% unless forloop.last %} / {% endunless %}
            {% endfor %}
          </span>
        {% endif %}

        {% if page.tags %}
          <span class="post-tags">
            🏷️ 標籤：
            {% for t in page.tags %}
              <a href="{{ '/tags.html#' | append: t | slugify | relative_url }}">{{ t }}</a>{% unless forloop.last %} / {% endunless %}
            {% endfor %}
          </span>
        {% endif %}

        <span class="reading-time">⏱️ 閱讀時間：約 {{ words | size | divided_by:200 | ceil }} 分鐘</span>
      </div>
    </header>

    <div class="post-content">
      {{ content }}
    </div>

    <footer class="post-footer">
      <div class="post-views">
        <strong>👁️ 瀏覽數：</strong><span id="view-count">…</span>
      </div>
    </footer>
    </article>
  </div>

  <!-- 右欄：側邊資訊 -->
  <aside class="siderail">
    <div class="card">
      <div class="card-title">📈 閱讀進度</div>
      <div class="reading-progress">
        <div class="progress-bar" id="reading-progress"></div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">🔗 快速導航</div>
      <div class="pill-group">
        <a class="pill" href="{{ '/' | relative_url }}">🏠 首頁</a>
        <a class="pill" href="{{ '/categories.html' | relative_url }}">📂 分類</a>
        <a class="pill" href="{{ '/tags.html' | relative_url }}">🏷️ 標籤</a>
        <a class="pill" href="{{ '/search.html' | relative_url }}">🔍 搜尋</a>
      </div>
    </div>

    {% if page.categories %}
    <div class="card">
      <div class="card-title">📂 相同分類</div>
      {% assign category = page.categories.first %}
      {% assign related_posts = site.categories[category] | where_exp: "post", "post.url != page.url" | slice: 0, 5 %}
      {% for post in related_posts %}
        <p><a href="{{ post.url | relative_url }}">{{ post.title }}</a></p>
        <small class="muted">{{ post.date | date: "%m-%d" }}</small>
      {% endfor %}
    </div>
    {% endif %}

    {% if page.tags %}
    <div class="card">
      <div class="card-title">🏷️ 相關標籤</div>
      <div class="pill-group">
        {% for tag in page.tags %}
          <a class="pill ghost" href="{{ '/tags.html#' | append: tag | relative_url }}">{{ tag }}</a>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </aside>
</div>

<script>
// 生成目錄 - HackMD 風格
document.addEventListener('DOMContentLoaded', function() {
  const toc = document.getElementById('toc');
  const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4');
  
  if (headings.length === 0) {
    document.querySelector('.toc').style.display = 'none';
    return;
  }
  
  let tocHTML = '<ul>';
  headings.forEach((heading, index) => {
    const id = `heading-${index}`;
    heading.id = id;
    
    const level = parseInt(heading.tagName.substring(1));
    const text = heading.textContent.trim();
    
    tocHTML += `
      <li>
        <a href="#${id}" class="toc-link" data-level="${level}">
          ${text}
        </a>
      </li>
    `;
  });
  tocHTML += '</ul>';
  
  toc.innerHTML = tocHTML;
  
  // 閱讀進度
  const progressBar = document.getElementById('reading-progress');
  window.addEventListener('scroll', function() {
    const post = document.querySelector('.post-content');
    const postTop = post.offsetTop;
    const postHeight = post.offsetHeight;
    const windowTop = window.scrollY;
    const windowHeight = window.innerHeight;
    
    const progress = Math.min(100, Math.max(0, 
      ((windowTop + windowHeight - postTop) / postHeight) * 100
    ));
    
    progressBar.style.width = progress + '%';
  });
  
  // TOC 高亮當前章節
  const tocLinks = document.querySelectorAll('.toc-link');
  window.addEventListener('scroll', function() {
    let current = '';
    headings.forEach(heading => {
      const rect = heading.getBoundingClientRect();
      if (rect.top <= 100) {
        current = heading.id;
      }
    });
    
    tocLinks.forEach(link => {
      link.classList.remove('active');
      if (link.getAttribute('href') === '#' + current) {
        link.classList.add('active');
      }
    });
  });
  
});
  
  if (!toc || !icon) return;
</script>

<!-- 代碼塊增強功能 -->
<script src="{{ '/assets/js/code-blocks.js' | relative_url }}"></script>
