---
layout: default
---

<!-- 文章專用兩欄布局 -->
<div class="article-layout">
  <!-- 左欄：階層式目錄 -->
  <aside class="article-sidebar">
    <div class="sidebar-content">
      <!-- 文章導航 -->
      <nav class="toc-nav" id="toc-nav">
        <!-- 目錄將通過 JavaScript 動態生成 -->
      </nav>
    </div>
  </aside>

  <!-- 右欄：主要文章內容 -->
  <main class="article-main">
    <article class="post-article">
      <header class="post-header">
        <h1 class="post-title">{{ page.title }}</h1>

        <div class="post-meta">
          <div class="meta-item">
            <span class="meta-icon">📅</span>
            <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y年%m月%d日" }}</time>
          </div>

          {% if page.categories.size > 0 %}
          <div class="meta-item">
            <span class="meta-icon">📂</span>
            <div class="meta-categories">
              {% for category in page.categories %}
                <span class="category-badge">{{ category }}</span>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          {% if page.tags.size > 0 %}
          <div class="meta-item">
            <span class="meta-icon">🏷️</span>
            <div class="meta-tags">
              {% for tag in page.tags %}
                <span class="tag-badge">{{ tag }}</span>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </header>

      <div class="post-content">
        {{ content }}
      </div>
    </article>
  </main>
</div>

<!-- 文章頁面專用腳本 -->
<script>
// 目錄生成和導航功能
document.addEventListener('DOMContentLoaded', function() {
  generateTOC();
  setupScrollSpy();
  setupSmoothScroll();
});

// 生成目錄
function generateTOC() {
  const content = document.querySelector('.post-article .post-content');
  const tocNav = document.getElementById('toc-nav');

  if (!content || !tocNav) return;

  const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
  if (headings.length === 0) {
    tocNav.innerHTML = '<p class="no-toc">本文沒有目錄</p>';
    return;
  }

  let tocHTML = '<ul class="toc-list">';
  let currentLevel = 1;
  let sectionCount = 0;

  headings.forEach((heading, index) => {
    const level = parseInt(heading.tagName.charAt(1));
    const text = heading.textContent.trim();
    const id = `section-${index + 1}`;

    // 為標題添加 ID
    heading.id = id;

    // 處理層級結構
    if (level > currentLevel) {
      for (let i = currentLevel; i < level; i++) {
        tocHTML += '<ul class="toc-sublist">';
      }
    } else if (level < currentLevel) {
      for (let i = currentLevel; i > level; i--) {
        tocHTML += '</ul>';
      }
    }

    tocHTML += `<li class="toc-item toc-level-${level}">
      <a href="#${id}" class="toc-link" data-target="${id}">
        <span class="toc-text">${text}</span>
      </a>
    </li>`;

    currentLevel = level;
    sectionCount++;
  });

  // 關閉所有未閉合的列表
  for (let i = 1; i < currentLevel; i++) {
    tocHTML += '</ul>';
  }

  tocHTML += '</ul>';
  tocNav.innerHTML = tocHTML;
}

// 滾動監聽和高亮當前章節
function setupScrollSpy() {
  const tocLinks = document.querySelectorAll('.toc-link');
  const headings = document.querySelectorAll('.post-article .post-content h1, .post-article .post-content h2, .post-article .post-content h3, .post-article .post-content h4, .post-article .post-content h5, .post-article .post-content h6');

  if (tocLinks.length === 0 || headings.length === 0) return;

  let currentActive = null;

  window.addEventListener('scroll', function() {
    const scrollPosition = window.scrollY + 100;

    headings.forEach((heading, index) => {
      const headingTop = heading.offsetTop;
      const headingBottom = headingTop + heading.offsetHeight;

      if (scrollPosition >= headingTop && scrollPosition < headingBottom) {
        const targetId = heading.id;

        // 移除之前的活躍狀態
        if (currentActive) {
          currentActive.classList.remove('active');
        }

        // 添加新的活躍狀態
        const activeLink = document.querySelector(`.toc-link[data-target="${targetId}"]`);
        if (activeLink) {
          activeLink.classList.add('active');
          currentActive = activeLink;
        }
      }
    });
  });
}

// 平滑滾動
function setupSmoothScroll() {
  document.querySelectorAll('.toc-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();

      const targetId = this.getAttribute('data-target');
      const targetElement = document.getElementById(targetId);

      if (targetElement) {
        const headerOffset = 80;
        const elementPosition = targetElement.offsetTop;
        const offsetPosition = elementPosition - headerOffset;

        window.scrollTo({
          top: offsetPosition,
          behavior: 'smooth'
        });

        // 更新 URL 但不觸發頁面重新載入
        history.pushState(null, null, `#${targetId}`);
      }
    });
  });
}
</script>
