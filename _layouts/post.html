---
layout: default
classes: post-page
---

{% assign words = page.content | strip_html | normalize_whitespace | split: ' ' %}
{% assign reading_time = words.size | divided_by: 200 | ceil %}

<div class="post-layout">
  <!-- æ–‡ç« ä¸»é«” -->
  <div class="post-container">
    <!-- å·¦å´ç›®éŒ„ -->
    <aside class="post-toc">
      <div class="toc-wrapper">
        <button class="toc-toggle" onclick="toggleTOC()" id="toc-toggle">
          <span id="toc-icon">ğŸ“‹</span>
          <span class="toc-text">ç›®éŒ„</span>
        </button>
        <nav id="toc-nav" class="toc-nav">
          <!-- JavaScript è‡ªå‹•ç”Ÿæˆ -->
        </nav>
      </div>
    </aside>

    <!-- ä¸­é–“å…§å®¹å€ -->
    <main class="post-main">
      <article class="post-article">
        <!-- æ–‡ç« æ¨™é¡Œå€ -->
        <header class="post-header">
          <div class="post-breadcrumb">
            <a href="{{ '/' | relative_url }}" class="breadcrumb-link">ğŸ  é¦–é </a>
            <span class="breadcrumb-separator">â€º</span>
            {% if page.categories.size > 0 %}
              <a href="{{ '/categories.html#' | append: page.categories.first | slugify | relative_url }}" class="breadcrumb-link">
                ğŸ“‚ {{ page.categories.first }}
              </a>
              <span class="breadcrumb-separator">â€º</span>
            {% endif %}
            <span class="breadcrumb-current">{{ page.title | truncate: 30 }}</span>
          </div>

          <h1 class="post-title glow-red rune-text">{{ page.title }}</h1>
          
          {% if page.description %}
          <p class="post-description">{{ page.description }}</p>
          {% endif %}

          <div class="post-meta">
            <div class="meta-primary">
              <div class="meta-item">
                <span class="meta-icon">ğŸ“…</span>
                <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Yå¹´%mæœˆ%dæ—¥" }}</time>
              </div>
              
              <div class="meta-item">
                <span class="meta-icon">â±ï¸</span>
                <span>ç´„ {{ reading_time }} åˆ†é˜é–±è®€</span>
              </div>
              
              <div class="meta-item">
                <span class="meta-icon">ğŸ‘ï¸</span>
                <span id="view-count">è¼‰å…¥ä¸­...</span>
              </div>

              {% if page.updated %}
              <div class="meta-item">
                <span class="meta-icon">ğŸ”„</span>
                <span>æ›´æ–°æ–¼ {{ page.updated | date: "%Y/%m/%d" }}</span>
              </div>
              {% endif %}
            </div>
            
            {% if page.categories.size > 0 or page.tags.size > 0 %}
            <div class="meta-secondary">
              {% if page.categories.size > 0 %}
              <div class="meta-group">
                <span class="meta-label">ï¿½ åˆ†é¡</span>
                <div class="meta-tags">
                  {% for category in page.categories %}
                    <a href="{{ '/categories.html#' | append: category | slugify | relative_url }}" class="meta-tag category-tag">{{ category }}</a>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
              
              {% if page.tags.size > 0 %}
              <div class="meta-group">
                <span class="meta-label">ğŸ·ï¸ æ¨™ç±¤</span>
                <div class="meta-tags">
                  {% for tag in page.tags %}
                    <a href="{{ '/tags.html#' | append: tag | slugify | relative_url }}" class="meta-tag tag-tag">{{ tag }}</a>
                  {% endfor %}
                </div>
              </div>
              {% endif %}
            </div>
            {% endif %}
          </div>
        </header>

        <!-- æ–‡ç« å…§å®¹ -->
        <div class="post-content">
          {{ content }}
        </div>

        <!-- æ–‡ç« çµå°¾ -->
        <footer class="post-footer">
          <div class="post-end-divider"></div>
          
          <div class="post-actions">
            <button class="action-btn primary" onclick="copyToClipboard()" id="copy-btn">
              <span class="btn-icon">ğŸ”—</span>
              <span class="btn-text">è¤‡è£½é€£çµ</span>
            </button>
            
            <button class="action-btn secondary" onclick="window.print()">
              <span class="btn-icon">ğŸ–¨ï¸</span>
              <span class="btn-text">åˆ—å°æ–‡ç« </span>
            </button>
            
            <button class="action-btn outline" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
              <span class="btn-icon">â¬†ï¸</span>
              <span class="btn-text">å›åˆ°é ‚éƒ¨</span>
            </button>
          </div>

          <div class="post-navigation">
            {% if page.previous %}
            <div class="nav-prev">
              <span class="nav-label">â† ä¸Šä¸€ç¯‡</span>
              <a href="{{ page.previous.url | relative_url }}" class="nav-link">{{ page.previous.title }}</a>
            </div>
            {% endif %}
            
            {% if page.next %}
            <div class="nav-next">
              <span class="nav-label">ä¸‹ä¸€ç¯‡ â†’</span>
              <a href="{{ page.next.url | relative_url }}" class="nav-link">{{ page.next.title }}</a>
            </div>
            {% endif %}
          </div>
        </footer>
      </article>
    </main>

    <!-- å³å´å·¥å…·æ¬„ -->
    <aside class="post-sidebar">
      <!-- é–±è®€é€²åº¦ -->
      <div class="sidebar-card">
        <h3 class="card-title">ğŸ“Š é–±è®€é€²åº¦</h3>
        <div class="progress-container">
          <div class="progress-track">
            <div class="progress-bar" id="reading-progress"></div>
          </div>
          <span class="progress-text" id="progress-text">0%</span>
        </div>
      </div>
      
      <!-- å¿«é€Ÿå‹•ä½œ -->
      <div class="sidebar-card">
        <h3 class="card-title">âš¡ å¿«é€Ÿå‹•ä½œ</h3>
        <div class="quick-actions">
          <button class="quick-btn" onclick="copyToClipboard()" title="è¤‡è£½æ–‡ç« é€£çµ">
            <span class="quick-icon">ğŸ”—</span>
          </button>
          <button class="quick-btn" onclick="window.print()" title="åˆ—å°æ–‡ç« ">
            <span class="quick-icon">ğŸ–¨ï¸</span>
          </button>
          <button class="quick-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" title="å›åˆ°é ‚éƒ¨">
            <span class="quick-icon">â¬†ï¸</span>
          </button>
          <button class="quick-btn" onclick="toggleTheme()" title="åˆ‡æ›ä¸»é¡Œ">
            <span class="quick-icon">ğŸŒ™</span>
          </button>
        </div>
      </div>

      <!-- ç›¸é—œæ–‡ç«  -->
      {% if page.categories.size > 0 %}
        {% assign category = page.categories.first %}
        {% assign related_posts = "" | split: "," %}
        {% for article in site.articles %}
          {% if article.categories contains category and article.url != page.url and related_posts.size < 5 %}
            {% assign related_posts = related_posts | push: article %}
          {% endif %}
        {% endfor %}
        {% if related_posts.size > 0 %}
        <div class="sidebar-card">
          <h3 class="card-title">ğŸ“‚ ç›¸é—œå¨è„…</h3>
          <div class="related-posts">
            {% for article in related_posts %}
              <article class="related-post">
                <a href="{{ article.url | relative_url }}" class="related-link">
                  <h4 class="related-title">{{ article.title | truncate: 40 }}</h4>
                  <div class="related-meta">
                    <span class="related-date">{{ article.date | date: "%m/%d" }}</span>
                    {% if article.tags.size > 0 %}
                      <span class="related-tag">{{ article.tags.first }}</span>
                    {% endif %}
                  </div>
                </a>
              </article>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      {% endif %}

      <!-- æ–‡ç« çµ±è¨ˆ -->
      <div class="sidebar-card">
        <h3 class="card-title">ğŸ“ˆ æ–‡ç« çµ±è¨ˆ</h3>
        <div class="article-stats">
          <div class="stat-item">
            <span class="stat-value">{{ words.size }}</span>
            <span class="stat-label">å­—æ•¸</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ reading_time }}</span>
            <span class="stat-label">åˆ†é˜</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="view-count-sidebar">-</span>
            <span class="stat-label">ç€è¦½</span>
          </div>
          {% if page.tags.size > 0 %}
          <div class="stat-item">
            <span class="stat-value">{{ page.tags.size }}</span>
            <span class="stat-label">æ¨™ç±¤</span>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- å°èˆªå¿«æ· -->
      <div class="sidebar-card">
        <h3 class="card-title">ğŸ§­ ç«™å…§å°èˆª</h3>
        <div class="nav-shortcuts">
          <a href="{{ '/' | relative_url }}" class="nav-shortcut">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-text">é¦–é </span>
          </a>
          <a href="{{ '/posts.html' | relative_url }}" class="nav-shortcut">
            <span class="nav-icon">ğŸ“š</span>
            <span class="nav-text">æ‰€æœ‰å¨è„…</span>
          </a>
          <a href="{{ '/categories.html' | relative_url }}" class="nav-shortcut">
            <span class="nav-icon">ğŸ“‚</span>
            <span class="nav-text">åˆ†é¡</span>
          </a>
          <a href="{{ '/tags.html' | relative_url }}" class="nav-shortcut">
            <span class="nav-icon">ğŸ·ï¸</span>
            <span class="nav-text">æ¨™ç±¤</span>
          </a>
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  
  // TOC è‡ªå‹•ç”Ÿæˆ
  function generateTOC() {
    const tocNav = document.getElementById('toc-nav');
    if (!tocNav) return;
    
    const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6');
    if (headings.length === 0) {
      document.querySelector('.post-toc').style.display = 'none';
      return;
    }
    
    const tocItems = [];
    
    headings.forEach((heading, index) => {
      // ç‚ºæ¨™é¡Œæ·»åŠ  ID
      if (!heading.id) {
        heading.id = 'heading-' + index;
      }
      
      const level = parseInt(heading.tagName.substring(1));
      const link = document.createElement('a');
      link.href = '#' + heading.id;
      link.textContent = heading.textContent.trim();
      link.className = `toc-link toc-level-${level}`;
      link.dataset.level = level;
      
      tocNav.appendChild(link);
      tocItems.push({ link, heading });
    });
    
    // TOC é»æ“Šäº‹ä»¶
    let isScrolling = false;
    
    tocItems.forEach(({ link, heading }) => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        isScrolling = true;
        
        // æ›´æ–°æ´»å‹•ç‹€æ…‹
        tocItems.forEach(({ link: l }) => l.classList.remove('active'));
        link.classList.add('active');
        
        // å¹³æ»‘æ»¾å‹•
        const targetPosition = heading.getBoundingClientRect().top + window.pageYOffset - 100;
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
        
        // æ›´æ–° URL
        history.replaceState(null, null, link.getAttribute('href'));
        
        setTimeout(() => { isScrolling = false; }, 1000);
      });
    });

    // æ»¾å‹•æ™‚æ›´æ–°æ´»å‹•é …ç›®
    function updateActiveTOC() {
      if (isScrolling) return;
      
      let activeItem = null;
      const scrollTop = window.pageYOffset + 150;
      
      for (let i = headings.length - 1; i >= 0; i--) {
        if (headings[i].offsetTop <= scrollTop) {
          activeItem = tocItems[i];
          break;
        }
      }
      
      tocItems.forEach(({ link }) => link.classList.remove('active'));
      if (activeItem) {
        activeItem.link.classList.add('active');
      }
    }
    
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateActiveTOC();
          ticking = false;
        });
        ticking = true;
      }
    });
    
    updateActiveTOC();
  }
  
  // TOC æ”¶èµ·å±•é–‹
  window.toggleTOC = function() {
    const tocWrapper = document.querySelector('.toc-wrapper');
    const tocIcon = document.getElementById('toc-icon');
    
    tocWrapper.classList.toggle('collapsed');
    tocIcon.textContent = tocWrapper.classList.contains('collapsed') ? 'ğŸ“‹' : 'ğŸ“‹';
  };
  
  // è¤‡è£½é€£çµåŠŸèƒ½
  window.copyToClipboard = function() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
      const btn = document.getElementById('copy-btn');
      const originalText = btn.querySelector('.btn-text').textContent;
      btn.querySelector('.btn-text').textContent = 'å·²è¤‡è£½ï¼';
      btn.classList.add('success');
      
      setTimeout(() => {
        btn.querySelector('.btn-text').textContent = originalText;
        btn.classList.remove('success');
      }, 2000);
    }).catch(err => {
      console.error('è¤‡è£½å¤±æ•—:', err);
    });
  };
  
  // é–±è®€é€²åº¦æ¢
  function initReadingProgress() {
    const progressBar = document.getElementById('reading-progress');
    const progressText = document.getElementById('progress-text');
    
    if (!progressBar) return;
    
    function updateProgress() {
      const scrollTop = window.pageYOffset;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollPercent = Math.min(Math.round((scrollTop / docHeight) * 100), 100);
      
      progressBar.style.width = scrollPercent + '%';
      if (progressText) {
        progressText.textContent = scrollPercent + '%';
      }
    }
    
    window.addEventListener('scroll', updateProgress, { passive: true });
    window.addEventListener('resize', updateProgress);
    updateProgress();
  }
  
  // éŸ¿æ‡‰å¼ TOC
  function handleResponsive() {
    const tocWrapper = document.querySelector('.toc-wrapper');
    if (window.innerWidth < 1200 && tocWrapper) {
      tocWrapper.classList.add('collapsed');
    }
  }
  
  // åˆå§‹åŒ–
  generateTOC();
  initReadingProgress();
  handleResponsive();
  
  window.addEventListener('resize', handleResponsive);
});
</script>

<!-- ä»£ç¢¼å¡Šå¢å¼·åŠŸèƒ½ -->
<script src="{{ '/assets/js/code-blocks.js' | relative_url }}"></script>
        </div>
      </footer>
    </article>
  </div>

  <!-- å³æ¬„ï¼šäº’å‹•å·¥å…· -->
  <aside class="siderail">
    <!-- é–±è®€é€²åº¦ -->
    <div class="card">
      <div class="card-title">ğŸ“Š é–±è®€é€²åº¦</div>
      <div class="progress-container">
        <div class="progress-bar" id="reading-progress"></div>
        <span class="progress-text" id="progress-text">0%</span>
      </div>
    </div>
    
    <!-- å¿«é€Ÿå‹•ä½œ -->
    <div class="card">
      <div class="card-title">âš¡ å¿«é€Ÿå‹•ä½œ</div>
      <div class="action-buttons">
        <button class="action-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">â¬†ï¸ å›é ‚éƒ¨</button>
        <button class="action-btn" onclick="copyToClipboard()">ğŸ”— è¤‡è£½é€£çµ</button>
        <button class="action-btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å°</button>
      </div>
    </div>

    <!-- ç›¸é—œæ–‡ç« ï¼ˆå¦‚æœæœ‰åˆ†é¡ï¼‰ -->
    {% if page.categories %}
      {% assign category = page.categories.first %}
      {% assign related_posts = site.categories[category] | where_exp: "post", "post.url != page.url" | slice: 0, 3 %}
      {% if related_posts.size > 0 %}
      <div class="card">
        <div class="card-title">ğŸ“‚ {{ category }}ç›¸é—œ</div>
        {% for post in related_posts %}
          <div class="related-post">
            <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
            <small class="post-date muted">ğŸ“… {{ post.date | date: "%mæœˆ%dæ—¥" }}</small>
          </div>
        {% endfor %}
      </div>
      {% endif %}
    {% endif %}

    <!-- å°èˆªé€£çµ -->
    <div class="card">
      <div class="card-title">ğŸ§­ ç«™å…§å°èˆª</div>
      <div class="pill-group">
        <a class="pill" href="{{ '/' | relative_url }}">ğŸ  é¦–é </a>
        <a class="pill" href="{{ '/categories.html' | relative_url }}">ğŸ“‚ åˆ†é¡</a>
        <a class="pill" href="{{ '/tags.html' | relative_url }}">ğŸ·ï¸ æ¨™ç±¤</a>
        <a class="pill" href="{{ '/search.html' | relative_url }}">ğŸ” æœå°‹</a>
      </div>
    </div>
  </aside>
</div>

<script>
// æ–‡ç« é é¢åŠŸèƒ½
document.addEventListener('DOMContentLoaded', function() {
  
  // TOC ç”ŸæˆåŠŸèƒ½
  function generateTOC() {
    const tocContainer = document.getElementById('toc');
    if (!tocContainer) return;
    
    const headings = document.querySelectorAll('.article-content h1, .article-content h2, .article-content h3, .article-content h4');
    if (headings.length === 0) {
      // å¦‚æœæ²’æœ‰æ¨™é¡Œï¼Œéš±è—TOC
      const tocAside = document.getElementById('post-toc');
      if (tocAside) tocAside.style.display = 'none';
      return;
    }
    
    const tocLinks = [];
    
    headings.forEach((heading, index) => {
      // ç‚ºæ¨™é¡Œæ·»åŠ IDï¼ˆå¦‚æœæ²’æœ‰ï¼‰
      if (!heading.id) {
        heading.id = 'heading-' + index;
      }
      
      const link = document.createElement('a');
      link.href = '#' + heading.id;
      link.textContent = heading.textContent;
      link.className = 'toc-link';
      
      // æ ¹æ“šæ¨™é¡Œå±¤ç´šè¨­ç½®æ¨£å¼
      const level = parseInt(heading.tagName.substring(1));
      if (level > 1) {
        link.style.paddingLeft = ((level - 1) * 1) + 'rem';
        if (level > 2) {
          link.style.fontSize = '0.85em';
          link.style.opacity = '0.8';
        }
      }
      
      tocContainer.appendChild(link);
      tocLinks.push(link);
    });
    
    // TOC é»æ“Šäº‹ä»¶å’Œé«˜äº®é‚è¼¯
    let isScrolling = false;
    
    tocLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        isScrolling = true;
        
        // ç§»é™¤æ‰€æœ‰ active ç‹€æ…‹
        tocLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - 100;
          window.scrollTo({
            top: targetPosition,
            behavior: "smooth"
          });
          history.replaceState(null, "", link.getAttribute('href'));
          
          setTimeout(() => {
            isScrolling = false;
          }, 1500);
        }
      });
    });

    // æ»¾å‹•æ™‚æ›´æ–°æ´»å‹•TOCé …ç›®
    function updateActiveTOC() {
      if (isScrolling) return;
      
      let currentActive = null;
      const scrollTop = window.pageYOffset + 120;
      
      // å¾å¾Œå¾€å‰æª¢æŸ¥ï¼Œæ‰¾åˆ°ç•¶å‰æ‡‰è©²é«˜äº®çš„å€åŸŸ
      for (let i = headings.length - 1; i >= 0; i--) {
        const heading = headings[i];
        if (heading.offsetTop <= scrollTop) {
          currentActive = tocLinks[i];
          break;
        }
      }
      
      // å¦‚æœæ²’æœ‰æ‰¾åˆ°ï¼Œæ ¹æ“šæ»¾å‹•ä½ç½®æ±ºå®š
      if (!currentActive) {
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        
        // å¦‚æœæ¥è¿‘é é¢åº•éƒ¨ï¼Œé«˜äº®æœ€å¾Œä¸€å€‹
        if (scrollTop + windowHeight >= documentHeight - 200) {
          currentActive = tocLinks[tocLinks.length - 1];
        } else {
          // å¦å‰‡é«˜äº®ç¬¬ä¸€å€‹
          currentActive = tocLinks[0];
        }
      }
      
      // æ›´æ–°é«˜äº®
      tocLinks.forEach(link => link.classList.remove('active'));
      if (currentActive) {
        currentActive.classList.add('active');
      }
    }
    
    let ticking = false;
    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateActiveTOC();
          ticking = false;
        });
        ticking = true;
      }
    }
    
    window.addEventListener('scroll', requestTick);
    updateActiveTOC();
  }
  
  // TOC æ”¶èµ·/å±•é–‹åŠŸèƒ½
  window.toggleTOC = function() {
    const toc = document.getElementById('post-toc');
    const icon = document.getElementById('toc-icon');
    
    if (!toc || !icon) return;
    
    if (toc.classList.contains('collapsed')) {
      toc.classList.remove('collapsed');
      icon.textContent = 'â˜°';
    } else {
      toc.classList.add('collapsed');
      icon.textContent = 'â–¶';
    }
  };
  
  // éŸ¿æ‡‰å¼æª¢æŸ¥
  function checkScreenWidth() {
    const toc = document.getElementById('post-toc');
    if (window.innerWidth < 1024 && toc) {
      toc.classList.add('collapsed');
      const icon = document.getElementById('toc-icon');
      if (icon) icon.textContent = 'â–¶';
    }
  }
  
  // è¤‡è£½é€£çµåŠŸèƒ½
  window.copyToClipboard = function() {
    navigator.clipboard.writeText(window.location.href).then(() => {
      // ç°¡å–®çš„æç¤ºæ•ˆæœ
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'âœ… å·²è¤‡è£½';
      setTimeout(() => btn.textContent = originalText, 2000);
    });
  };
  
  // åˆå§‹åŒ–é–±è®€é€²åº¦æ¢
  function initReadingProgress() {
    const progressBar = document.getElementById('reading-progress');
    const progressText = document.getElementById('progress-text');
    
    if (!progressBar) return;
    
    function updateProgress() {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollPercent = Math.min(Math.round((scrollTop / docHeight) * 100), 100);
      
      progressBar.style.width = scrollPercent + '%';
      if (progressText) progressText.textContent = scrollPercent + '%';
    }
    
    // åˆå§‹åŒ–å’Œäº‹ä»¶ç›£è½
    updateProgress();
    window.addEventListener('scroll', updateProgress, { passive: true });
    window.addEventListener('resize', updateProgress);
  }
  
  // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
  generateTOC();
  checkScreenWidth();
  window.addEventListener('resize', checkScreenWidth);
  
  // å»¶é²åˆå§‹åŒ–é¿å…å¸ƒå±€å•é¡Œ
  setTimeout(initReadingProgress, 100);
});
</script>

<!-- ä»£ç¢¼å¡Šå¢å¼·åŠŸèƒ½ -->
<script src="{{ '/assets/js/code-blocks.js' | relative_url }}"></script>
