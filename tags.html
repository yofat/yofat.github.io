---
layout: default
title: æ¨™ç±¤
permalink: /tags.html
classes: grid-page
---

<div class="grid-3col content-root">
  <!-- å·¦æ¬„ï¼šTOC å°èˆª -->
  <aside class="toc">
    <h3>å¤§ç¶±</h3>
    <nav id="toc">
      <!-- JavaScript æœƒæ ¹æ“šé é¢å…§å®¹è‡ªå‹•ç”Ÿæˆ TOC -->
    </nav>
  </aside>

  <!-- ä¸­æ¬„ï¼šä¸»è¦å…§å®¹ -->
  <div class="maincol">
    <section class="section">
      <h1 id="top">æ¨™ç±¤</h1>
      <p class="muted">ğŸ·ï¸ æ¢ç´¢æ‰€æœ‰æ–‡ç« æ¨™ç±¤</p>

      <!-- æ¨™ç±¤å°èˆª -->
      <div class="tags-nav">
        {% assign all_tags = site.collections.articles.docs | map: 'tags' | join: ',' | split: ',' | uniq | sort %}
        {% for tag in all_tags %}
          {% unless tag == blank %}
            <a href="#{{ tag | slugify }}" class="tag-nav-link">{{ tag }}</a>
          {% endunless %}
        {% endfor %}
      </div>

      <!-- å„æ¨™ç±¤å…§å®¹ -->
      {% for tag in all_tags %}
        {% unless tag == blank %}
          {% assign tag_posts = site.collections.articles.docs | where_exp: "doc", "doc.tags contains tag" %}
          {% if tag_posts.size > 0 %}
            <section class="tag-section" id="{{ tag | slugify }}">
              <h2>{{ tag }} <span class="count">({{ tag_posts.size }})</span></h2>
              
              <div class="articles-container">
                {% for article in tag_posts %}
                  <article class="article-card">
                    <div class="article-content">
                      <h3><a href="{{ article.url | relative_url }}">{{ article.title }}</a></h3>
                      
                      <div class="article-meta">
                        <span class="article-date">
                          {{ article.date | default: '2025-01-01' | date: "%Yå¹´%mæœˆ%dæ—¥" }}
                        </span>
                        
                        {% if article.category %}
                          <span class="article-category">{{ article.category }}</span>
                        {% endif %}
                        
                        {% if article.tags and article.tags.size > 0 %}
                          <div class="article-tags">
                            {% for tag_item in article.tags %}
                              <span class="tag">{{ tag_item }}</span>
                            {% endfor %}
                          </div>
                        {% endif %}
                      </div>
                      
                      {% if article.excerpt %}
                        <p class="article-excerpt">{{ article.excerpt | strip_html | truncatewords: 15 }}</p>
                      {% endif %}
                    </div>
                  </article>
                {% endfor %}
              </div>
            </section>
          {% endif %}
        {% endunless %}
      {% endfor %}

      <div class="back-nav">
        <a href="{{ '/' | relative_url }}" class="back-link">â† è¿”å›é¦–é </a>
      </div>
    </section>
  </div>

  <!-- å³æ¬„ï¼šå´é‚Šè³‡è¨Š -->
  <aside class="siderail">
    <!-- çµ±è¨ˆè³‡è¨Š -->
    <div class="card stats-card">
      <h3>ğŸ“Š æ¨™ç±¤çµ±è¨ˆ</h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number">{{ site.collections.articles.docs.size }}</div>
          <div class="stat-label">ç¸½æ–‡ç« æ•¸</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ all_tags.size }}</div>
          <div class="stat-label">æ¨™ç±¤æ•¸é‡</div>
        </div>
      </div>
    </div>

    <!-- ç†±é–€æ¨™ç±¤ -->
    <div class="card">
      <h3>ğŸ·ï¸ ç†±é–€æ¨™ç±¤</h3>
      <div class="popular-tags">
        <!-- JavaScript å°‡å‹•æ…‹è¨ˆç®—ä¸¦é¡¯ç¤ºç†±é–€æ¨™ç±¤ -->
      </div>
    </div>

    <!-- å¿«é€Ÿå°èˆª -->
    <div class="card">
      <h3>ğŸ“ å¿«é€Ÿè·³è½‰</h3>
      <div class="nav-links">
        <a href="{{ '/categories.html' | relative_url }}" class="nav-link">ğŸ“‚ åˆ†é¡ç€è¦½</a>
        <a href="{{ '/posts.html' | relative_url }}" class="nav-link">ğŸ“° å…¨éƒ¨æ–‡ç« </a>
        <a href="{{ '/search.html' | relative_url }}" class="nav-link">ğŸ” æœå°‹æ–‡ç« </a>
      </div>
    </div>
  </aside>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // æ¨™ç±¤é é¢çš„ TOC ç”Ÿæˆå’Œçµ±è¨ˆæ•¸æ“š
  const tocContainer = document.getElementById("toc");
  if (tocContainer) {
    const sections = document.querySelectorAll('h1[id], h2[id], h3[id]');
    const tocLinks = [];
    
    sections.forEach(section => {
      const link = document.createElement('a');
      link.href = '#' + section.id;
      link.textContent = section.textContent;
      link.className = 'toc-link';
      
      // æ ¹æ“šæ¨™é¡Œå±¤ç´šè¨­ç½®æ¨£å¼
      if (section.tagName === 'H1') {
        link.style.fontWeight = 'bold';
      } else if (section.tagName === 'H2') {
        link.style.paddingLeft = '1rem';
      } else if (section.tagName === 'H3') {
        link.style.paddingLeft = '2rem';
        link.style.fontSize = '0.9em';
        link.style.opacity = '0.8';
      }
      
      tocContainer.appendChild(link);
      tocLinks.push(link);
    });

    // TOC é»æ“Šäº‹ä»¶å’Œé«˜äº®é‚è¼¯
    let isScrolling = false;
    
    tocLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        isScrolling = true;
        
        // ç§»é™¤æ‰€æœ‰ active ç‹€æ…‹
        tocLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - 100;
          window.scrollTo({
            top: targetPosition,
            behavior: "smooth"
          });
          history.replaceState(null, "", link.getAttribute('href'));
          
          setTimeout(() => {
            isScrolling = false;
          }, 1500);
        }
      });
    });

    function updateActiveTOC() {
      if (isScrolling) return;
      
      let currentActive = null;
      const scrollTop = window.pageYOffset + 120;
      
      // å¾å¾Œå¾€å‰æª¢æŸ¥ï¼Œæ‰¾åˆ°ç•¶å‰æ‡‰è©²é«˜äº®çš„å€åŸŸ
      for (let i = sections.length - 1; i >= 0; i--) {
        const section = sections[i];
        if (section.offsetTop <= scrollTop) {
          currentActive = tocLinks[i];
          break;
        }
      }
      
      // å¦‚æœæ²’æœ‰æ‰¾åˆ°ï¼Œæ ¹æ“šæ»¾å‹•ä½ç½®æ±ºå®š
      if (!currentActive) {
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        
        // å¦‚æœæ¥è¿‘é é¢åº•éƒ¨ï¼Œé«˜äº®æœ€å¾Œä¸€å€‹
        if (scrollTop + windowHeight >= documentHeight - 200) {
          currentActive = tocLinks[tocLinks.length - 1];
        } else {
          // å¦å‰‡é«˜äº®ç¬¬ä¸€å€‹
          currentActive = tocLinks[0];
        }
      }
      
      // æ›´æ–°é«˜äº®
      tocLinks.forEach(link => link.classList.remove('active'));
      if (currentActive) {
        currentActive.classList.add('active');
        
        // ç¢ºä¿æ´»å‹•é …ç›®åœ¨TOCä¸­å¯è¦‹
        const tocContainer = document.getElementById('toc');
        if (tocContainer && currentActive) {
          const containerRect = tocContainer.getBoundingClientRect();
          const activeRect = currentActive.getBoundingClientRect();
          
          if (activeRect.bottom > containerRect.bottom || activeRect.top < containerRect.top) {
            currentActive.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'center',
              inline: 'nearest' 
            });
          }
        }
      }
    }
    
    let ticking = false;
    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateActiveTOC();
          ticking = false;
        });
        ticking = true;
      }
    }
    
    window.addEventListener('scroll', requestTick);
    updateActiveTOC();
  }

  // çµ±è¨ˆæ•¸æ“šæ›´æ–° - å¾å¯¦éš›æ–‡ç« æ•¸æ“šè¨ˆç®—
  const allArticles = document.querySelectorAll('.article-card');
  const totalArticles = allArticles.length;
  
  const tagCount = new Map();
  allArticles.forEach(article => {
    const tagsContainer = article.querySelector('.article-tags');
    if (tagsContainer) {
      const tags = tagsContainer.querySelectorAll('.tag');
      tags.forEach(tagElement => {
        const tag = tagElement.textContent.trim();
        tagCount.set(tag, (tagCount.get(tag) || 0) + 1);
      });
    }
  });
  
  // æ›´æ–°å³æ¬„çµ±è¨ˆæ•¸æ“š
  const statsElement = document.querySelector('.stats-grid .stat-number');
  if (statsElement) {
    statsElement.textContent = totalArticles;
  }
  
  const tagsStatElement = document.querySelectorAll('.stats-grid .stat-number')[1];
  if (tagsStatElement) {
    tagsStatElement.textContent = tagCount.size;
  }
  
  // æ›´æ–°ç†±é–€æ¨™ç±¤
  const popularTagsContainer = document.querySelector('.popular-tags');
  if (popularTagsContainer) {
    // æ¸…ç©ºç¾æœ‰å…§å®¹
    popularTagsContainer.innerHTML = '';
    
    // å°‡æ¨™ç±¤æŒ‰ä½¿ç”¨æ¬¡æ•¸æ’åº
    const sortedTags = Array.from(tagCount.entries())
      .sort((a, b) => b[1] - a[1])
      .slice(0, 8); // åªé¡¯ç¤ºå‰8å€‹
    
    sortedTags.forEach(([tag, count]) => {
      const tagLink = document.createElement('a');
      tagLink.href = '#' + tag.toLowerCase().replace(/\s+/g, '-');
      tagLink.className = 'tag-link';
      tagLink.innerHTML = `${tag} <span class="count">(${count})</span>`;
      popularTagsContainer.appendChild(tagLink);
    });
  }
});

// TOC æ”¶èµ·/å±•é–‹åŠŸèƒ½ (å…¨åŸŸå‡½å¼)
function toggleTOC() {
  const toc = document.getElementById('post-toc');
  const icon = document.getElementById('toc-icon');
  
  if (!toc || !icon) return;
  
  if (toc.classList.contains('collapsed')) {
    toc.classList.remove('collapsed');
    icon.textContent = 'â˜°';
  } else {
    toc.classList.add('collapsed');
    icon.textContent = 'â–¶';
  }
}

// éŸ¿æ‡‰å¼æª¢æŸ¥
function checkScreenWidth() {
  const toc = document.getElementById('post-toc');
  if (window.innerWidth < 1024 && toc) {
    toc.classList.add('collapsed');
    const icon = document.getElementById('toc-icon');
    if (icon) icon.textContent = 'â–¶';
  }
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  checkScreenWidth();
  window.addEventListener('resize', checkScreenWidth);
  
  // æ¨™ç±¤å°èˆªé»æ“Šå¹³æ»‘æ»¾å‹•
  document.querySelectorAll('.tag-nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });
});
</script>