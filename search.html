---
layout: default
title: æœå°‹
permalink: /search.html
classes: grid-page
---

<div class="grid-3col content-root">
  <!-- å·¦æ¬„ï¼šTOC -->
  <aside class="toc">
    <h3>å¤§ç¶±</h3>
    <nav id="toc">
      <!-- JavaScript æœƒæ ¹æ“šé é¢å…§å®¹è‡ªå‹•ç”Ÿæˆ TOC -->
    </nav>
  </aside>

  <!-- ä¸­æ¬„ï¼šä¸»è¦å…§å®¹ -->
  <div class="maincol">
    <section class="section">
      <div class="search-hero">
        <h1 id="search-title">ğŸ” æ¢ç´¢çŸ¥è­˜å¯¶åº«</h1>
        <p class="search-subtitle">åœ¨æ•¸åƒç¯‡ç²¾é¸æ–‡ç« ä¸­å°‹æ‰¾æ‚¨æ„Ÿèˆˆè¶£çš„å…§å®¹</p>
        
        <div class="search-container">
          <div class="search-input-wrapper">
            <div class="search-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
            <input 
              id="search-input" 
              type="search" 
              placeholder="æœå°‹æ–‡ç« æ¨™é¡Œã€å…§å®¹ã€æ¨™ç±¤..." 
              aria-label="Search"
              autocomplete="off"
            />
            <div id="search-clear" class="search-clear" title="æ¸…é™¤æœå°‹">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
          
          <div class="search-suggestions">
            <span class="search-label">ç†±é–€æœå°‹ï¼š</span>
            <div class="suggestion-tags">
              <span class="suggestion-tag" data-search="Python">Python</span>
              <span class="suggestion-tag" data-search="JavaScript">JavaScript</span>
              <span class="suggestion-tag" data-search="AI">äººå·¥æ™ºèƒ½</span>
              <span class="suggestion-tag" data-search="å®‰å…¨">ç¶²è·¯å®‰å…¨</span>
              <span class="suggestion-tag" data-search="å‰ç«¯">å‰ç«¯é–‹ç™¼</span>
            </div>
          </div>
          
          <div class="search-stats">
            <div class="stats-content">
              <span id="search-count">âœ¨ æº–å‚™å¥½æ¢ç´¢äº†å—ï¼Ÿè¼¸å…¥é—œéµå­—é–‹å§‹æœå°‹</span>
              <div class="search-loader" id="search-loader"></div>
            </div>
          </div>
        </div>
      </div>

  <div id="search-results" class="search-results" role="list"></div>

  <div class="search-tips">
    <h2 id="search-tips">ğŸ’¡ æœå°‹å°æŠ€å·§</h2>
    <ul>
      <li>æ”¯æ´æ¨¡ç³Šæœå°‹å’Œé—œéµå­—åŒ¹é…</li>
      <li>æœå°‹ç¯„åœåŒ…å«æ¨™é¡Œã€å…§å®¹ã€æ¨™ç±¤å’Œåˆ†é¡</li>
      <li>ä½¿ç”¨ç©ºæ ¼åˆ†éš”å¤šå€‹é—œéµå­—é€²è¡Œçµ„åˆæœå°‹</li>
      <li>ä¸å€åˆ†å¤§å°å¯«ï¼Œæ”¯æ´ä¸­è‹±æ–‡æœå°‹</li>
    </ul>
  </div>

  <div class="popular-posts">
    <h3>ğŸ”¥ æ¨è–¦æ–‡ç« </h3>
    <div class="horizontal-posts">
      {% if site.articles %}
        {% assign featured_articles = site.articles | sort: 'date' | reverse | limit: 3 %}
      {% else %}
        {% assign featured_articles = site.posts | sort: 'date' | reverse | limit: 3 %}
      {% endif %}
      {% for article in featured_articles %}
        <article class="post-card">
          <h4><a href="{{ article.url | relative_url }}">{{ article.title }}</a></h4>
          {% if article.excerpt %}
            <p class="post-excerpt">{{ article.excerpt | strip_html | truncatewords: 15 }}</p>
          {% endif %}
          <div class="post-meta">
            <span class="post-date">ğŸ“… {{ article.date | default: '2025-01-01' | date: "%Y-%m-%d" }}</span>
            {% if article.category %}
              <span class="post-category">{{ article.category }}</span>
            {% endif %}
            {% if article.tags and article.tags.size > 0 %}
              <div class="post-tags">
                {% for tag in article.tags limit: 2 %}
                  <span class="tag">{{ tag }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  </div>
    </section>
  </div>

  <!-- å³æ¬„ï¼šå´é‚Šè³‡è¨Š -->
  <aside class="siderail">
    <!-- çµ±è¨ˆè³‡è¨Š -->
    <div class="card stats-card">
      <h3>ğŸ“Š æœå°‹çµ±è¨ˆ</h3>
      <div class="stats-grid">
        <div class="stat-item">
          {% if site.articles %}
            <div class="stat-number">{{ site.articles.size }}</div>
          {% else %}
            <div class="stat-number">{{ site.posts.size }}</div>
          {% endif %}
          <div class="stat-label">ç¸½æ–‡ç« æ•¸</div>
        </div>
        <div class="stat-item">
          {% if site.articles %}
            <div class="stat-number">{{ site.articles | map: 'category' | uniq | size }}</div>
          {% else %}
            <div class="stat-number">{{ site.posts | map: 'categories' | flatten | uniq | size }}</div>
          {% endif %}
          <div class="stat-label">åˆ†é¡æ•¸é‡</div>
        </div>
      </div>
    </div>

    <!-- ç†±é–€æ–‡ç«  -->
    <div class="card">
      <h3>ğŸ”¥ ç†±é–€æ–‡ç« </h3>
      <div class="popular-articles">
        {% if site.articles %}
          {% assign recent_articles = site.articles | sort: 'date' | reverse | limit: 5 %}
        {% else %}
          {% assign recent_articles = site.posts | sort: 'date' | reverse | limit: 5 %}
        {% endif %}
        {% for article in recent_articles %}
          <a href="{{ article.url | relative_url }}" class="popular-article-link">
            <h4>{{ article.title }}</h4>
            <div class="article-meta">
              <span class="article-date">{{ article.date | default: '2025-01-01' | date: "%Y-%m-%d" }}</span>
              {% if article.category %}
                <span class="article-category">{{ article.category }}</span>
              {% endif %}
            </div>
          </a>
        {% endfor %}
      </div>
    </div>

    <!-- å¿«é€Ÿå°èˆª -->
    <div class="card">
      <h3>ğŸ“ å¿«é€Ÿè·³è½‰</h3>
      <div class="nav-links">
        <a href="{{ '/categories.html' | relative_url }}" class="nav-link">ğŸ“‚ åˆ†é¡ç€è¦½</a>
        <a href="{{ '/tags.html' | relative_url }}" class="nav-link">ğŸ·ï¸ æ¨™ç±¤ç€è¦½</a>
        <a href="{{ '/posts.html' | relative_url }}" class="nav-link">ğŸ“° å…¨éƒ¨æ–‡ç« </a>
      </div>
    </div>
  </aside>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const input = document.getElementById('search-input');
  const results = document.getElementById('search-results');
  const clearBtn = document.getElementById('search-clear');
  
  // æœå°‹æ¡†UIåŠŸèƒ½
  input.addEventListener('input', () => {
    if (input.value.trim()) {
      clearBtn.classList.add('show');
    } else {
      clearBtn.classList.remove('show');
    }
  });
  
  clearBtn.addEventListener('click', () => {
    input.value = '';
    clearBtn.classList.remove('show');
    input.focus();
    // æ¸…ç©ºæœå°‹çµæœ
    results.innerHTML = '';
    const searchCount = document.getElementById('search-count');
    if (searchCount) {
      searchCount.innerHTML = 'âœ¨ æº–å‚™å¥½æ¢ç´¢äº†å—ï¼Ÿè¼¸å…¥é—œéµå­—é–‹å§‹æœå°‹';
    }
  });
  
  // å»ºè­°æ¨™ç±¤é»æ“ŠåŠŸèƒ½
  document.querySelectorAll('.suggestion-tag').forEach(tag => {
    tag.addEventListener('click', () => {
      const searchTerm = tag.dataset.search;
      input.value = searchTerm;
      input.focus();
      clearBtn.classList.add('show');
      // è§¸ç™¼æœå°‹
      performSearch();
    });
  });

  let data = [];
  let idx = null;
  
  try {
    const res = await fetch('{{ "/search.json" | relative_url }}');
    data = await res.json();
    
    idx = lunr(function () {
      this.ref('url');
      this.field('title', { boost: 10 });
      this.field('categories', { boost: 5 });
      this.field('tags', { boost: 5 });
      this.field('content');
      
      data.forEach((doc) => {
        this.add(doc);
      });
    });
  } catch (error) {
    console.error('è¼‰å…¥æœå°‹æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
    return;
  }

  function highlightText(text, query) {
    if (!query) return text;
    const regex = new RegExp(`(${query.split(' ').join('|')})`, 'gi');
    return text.replace(regex, '<span class="search-highlight">$1</span>');
  }

  function render(items, query = '') {
    const searchCount = document.getElementById('search-count');
    const searchLoader = document.getElementById('search-loader');
    
    // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
    if (query && searchLoader) {
      searchLoader.classList.add('show');
      searchCount.innerHTML = 'ğŸ” æ­£åœ¨æœå°‹ä¸­...';
    }
    
    // å»¶é²é¡¯ç¤ºçµæœï¼Œè®“ç”¨æˆ¶çœ‹åˆ°è¼‰å…¥æ•ˆæœ
    setTimeout(() => {
      results.innerHTML = '';
      results.classList.remove('search-loading');
      if (searchLoader) searchLoader.classList.remove('show');
      
      if (query && items.length > 0) {
        searchCount.innerHTML = `ğŸ‰ æ‰¾åˆ° <strong>${items.length}</strong> ç¯‡ç›¸é—œæ–‡ç« `;
      } else if (query && items.length === 0) {
        searchCount.innerHTML = 'ğŸ˜” æ²’æœ‰æ‰¾åˆ°ç›¸é—œæ–‡ç« ï¼Œè©¦è©¦å…¶ä»–é—œéµå­—ï¼Ÿ';
      } else {
        searchCount.innerHTML = 'âœ¨ æº–å‚™å¥½æ¢ç´¢äº†å—ï¼Ÿè¼¸å…¥é—œéµå­—é–‹å§‹æœå°‹';
      }
    
    // æ’åºçµæœæŒ‰ç›¸é—œæ€§å’Œæ—¥æœŸ
    items.sort((a, b) => {
      // é¦–å…ˆæŒ‰ç›¸é—œæ€§åˆ†æ•¸æ’åº
      const scoreDiff = (b.score || 1) - (a.score || 1);
      if (Math.abs(scoreDiff) > 0.1) return scoreDiff;
      
      // ç›¸é—œæ€§ç›¸ä¼¼æ™‚æŒ‰æ—¥æœŸæ’åº
      const docA = data.find(d => d.url === a.ref);
      const docB = data.find(d => d.url === b.ref);
      return new Date(docB.date) - new Date(docA.date);
    });
    
    items.forEach((item, index) => {
      const doc = data.find(d => d.url === item.ref);
      
      const article = document.createElement('article');
      article.className = 'search-result-item';
      article.style.animationDelay = `${index * 0.1}s`;
      
      const title = document.createElement('h3');
      const titleLink = document.createElement('a');
      titleLink.href = doc.url;
      titleLink.innerHTML = highlightText(doc.title, query);
      title.appendChild(titleLink);
      
      const meta = document.createElement('div');
      meta.className = 'search-meta';
      
      const date = document.createElement('span');
      date.className = 'search-date';
      date.textContent = doc.date;
      
      const categories = document.createElement('span');
      categories.className = 'search-categories';
      if (doc.categories && doc.categories.length > 0) {
        categories.innerHTML = doc.categories.map(cat => 
          `<span class="category-tag">${cat}</span>`
        ).join('');
      }
      
      const tags = document.createElement('span');
      tags.className = 'search-tags';
      if (doc.tags && doc.tags.length > 0) {
        tags.innerHTML = doc.tags.map(tag => 
          `<span class="tag-item">#${tag}</span>`
        ).join('');
      }
      
      meta.appendChild(date);
      if (categories.innerHTML) meta.appendChild(categories);
      if (tags.innerHTML) meta.appendChild(tags);
      
      const excerpt = document.createElement('p');
      excerpt.className = 'search-excerpt';
      
      // å˜—è©¦æ‰¾åˆ°åŒ…å«é—œéµå­—çš„æ®µè½ä½œç‚ºæ‘˜è¦
      let excerptText = '';
      if (doc.content) {
        const sentences = doc.content.split(/[ã€‚.!?ï¼ï¼Ÿ]/);
        const queryWords = query.toLowerCase().split(/\s+/);
        
        // æ‰¾åˆ°åŒ…å«æœ€å¤šé—œéµå­—çš„å¥å­
        let bestSentence = sentences[0] || '';
        let maxMatches = 0;
        
        sentences.forEach(sentence => {
          const sentenceLower = sentence.toLowerCase();
          const matches = queryWords.filter(word => 
            sentenceLower.includes(word.toLowerCase())).length;
          
          if (matches > maxMatches) {
            maxMatches = matches;
            bestSentence = sentence;
          }
        });
        
        excerptText = bestSentence.trim();
        if (excerptText.length > 150) {
          excerptText = excerptText.substring(0, 150) + '...';
        }
        if (!excerptText) {
          excerptText = doc.content.substring(0, 150) + '...';
        }
      }
      
      excerpt.innerHTML = highlightText(excerptText, query);
      
      article.appendChild(title);
      article.appendChild(meta);
      article.appendChild(excerpt);
      
      results.appendChild(article);
    });
    
    if (query && items.length === 0) {
      const noResults = document.createElement('div');
      noResults.className = 'no-results';
      noResults.innerHTML = `
        <div class="no-results-icon">ğŸ“­</div>
        <p>æ‰¾ä¸åˆ°åŒ…å«ã€Œ<strong>${query}</strong>ã€çš„æ–‡ç« </p>
        <p class="muted">è©¦è©¦å…¶ä»–é—œéµå­—æˆ–æª¢æŸ¥æ‹¼å¯«</p>
      `;
      results.appendChild(noResults);
    }
    
    }, query ? 300 : 0); // å¦‚æœæœ‰æŸ¥è©¢å‰‡å»¶é²300msé¡¯ç¤º
  }
  
  function performSearch() {
    const q = input.value.trim();
    if (!q) {
      render([], '');
      clearBtn.classList.remove('show');
      return;
    }
    
    clearBtn.classList.add('show');
    
    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    results.classList.add('search-loading');
    document.getElementById('search-count').textContent = 'æœå°‹ä¸­...';
    
    // ä½¿ç”¨ setTimeout è®“ UI æœ‰æ™‚é–“æ›´æ–°
    setTimeout(() => {
      try {
        const items = simpleSearch(q);
        render(items, q);
      } catch (e) {
        render([], q);
      }
    }, 100);
  }
  
  // ç°¡å–®çš„æœå°‹ç®—æ³•
  function simpleSearch(query) {
    const results = [];
    const queryLower = query.toLowerCase().trim();
    
    if (!queryLower) return [];
    
    data.forEach((doc) => {
      let score = 0;
      const titleLower = doc.title ? doc.title.toLowerCase() : '';
      const contentLower = doc.content ? doc.content.toLowerCase() : '';
      
      // æ¨™é¡ŒåŒ¹é… (æœ€é«˜æ¬Šé‡)
      if (titleLower.indexOf(queryLower) !== -1) {
        score += 100;
      }
      
      // åˆ†é¡åŒ¹é…
      if (doc.categories && Array.isArray(doc.categories)) {
        for (const cat of doc.categories) {
          if (cat && cat.toLowerCase().indexOf(queryLower) !== -1) {
            score += 50;
          }
        }
      }
      
      // æ¨™ç±¤åŒ¹é…
      if (doc.tags && Array.isArray(doc.tags)) {
        for (const tag of doc.tags) {
          if (tag && tag.toLowerCase().indexOf(queryLower) !== -1) {
            score += 50;
          }
        }
      }
      
      // å…§å®¹åŒ¹é… (è¼ƒä½æ¬Šé‡)
      if (contentLower.indexOf(queryLower) !== -1) {
        score += 10;
      }
      
      if (score > 0) {
        results.push({ ref: doc.url, score });
      }
    });
    
    return results.sort((a, b) => b.score - a.score);
  }
  
  input.addEventListener('input', performSearch);
  
  // éµç›¤å¿«æ·éµ
  document.addEventListener('keydown', (e) => {
    // Ctrl/Cmd + K èšç„¦æœå°‹æ¡†
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      input.focus();
    }
    
    // ESC æ¸…é™¤æœå°‹
    if (e.key === 'Escape' && document.activeElement === input) {
      input.value = '';
      performSearch();
    }
  });
  
  // å‹•æ…‹ placeholder
  const placeholders = [
    'æœå°‹æ–‡ç« ã€æ¨™ç±¤ã€åˆ†é¡... (Ctrl+K)',
    'è©¦è©¦æœå°‹ "Python"ã€"Jekyll"...',
    'è¼¸å…¥ä»»ä½•é—œéµå­—é–‹å§‹æœå°‹...',
    'æœå°‹æŠ€è¡“æ–‡ç« å’Œæ•™å­¸å…§å®¹...'
  ];
  
  let placeholderIndex = 0;
  function updatePlaceholder() {
    if (!input.value && document.activeElement !== input) {
      input.placeholder = placeholders[placeholderIndex];
      placeholderIndex = (placeholderIndex + 1) % placeholders.length;
    }
  }
  
  // æ¯ 3 ç§’æ›´æ› placeholder
  setInterval(updatePlaceholder, 3000);
  updatePlaceholder();
  
  // ç•¶è¼¸å…¥æ¡†ç²å¾—ç„¦é»æ™‚ä½¿ç”¨æ¨™æº– placeholder
  input.addEventListener('focus', () => {
    input.placeholder = 'è¼¸å…¥é—œéµå­—æœå°‹...';
  });
  
  input.addEventListener('blur', updatePlaceholder);
  
  // åˆå§‹åŒ–æ™‚éš±è—æ¸…é™¤æŒ‰éˆ•
  clearBtn.classList.remove('show');
  
  // ç†±é–€æ–‡ç« æ¨™ç±¤é»æ“Šæœå°‹
  document.addEventListener('click', (e) => {
    if (e.target.classList.contains('tag')) {
      e.preventDefault();
      const tagText = e.target.textContent;
      input.value = tagText;
      input.focus();
      performSearch();
      
      // æ»¾å‹•åˆ°æœå°‹çµæœ
      document.getElementById('search-results').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start' 
      });
    }
  });

  // é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•èšç„¦æœå°‹æ¡†
  input.focus();
  
  // æœå°‹é é¢çš„ TOC ç”Ÿæˆ
  const tocContainer = document.getElementById("toc");
  if (tocContainer) {
    const tocItems = [
      { href: '#search-title', text: 'ğŸ” æœå°‹æ–‡ç« ' },
      { href: '#search-tips', text: 'ğŸ’¡ æœå°‹å°æŠ€å·§' },
    ];

    const tocLinks = [];
    tocItems.forEach(item => {
      const link = document.createElement('a');
      link.href = item.href;
      link.textContent = item.text;
      link.className = 'toc-link';
      tocContainer.appendChild(link);
      tocLinks.push(link);
    });

    // TOC é»æ“Šäº‹ä»¶å’Œé«˜äº®é‚è¼¯
    let isScrolling = false;
    
    tocItems.forEach((item, index) => {
      const link = tocLinks[index];
      if (link) {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          isScrolling = true;
          
          tocLinks.forEach(l => l.classList.remove('active'));
          link.classList.add('active');
          
          const target = document.querySelector(item.href);
          if (target) {
            const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - 100;
            window.scrollTo({
              top: targetPosition,
              behavior: "smooth"
            });
            history.replaceState(null, "", item.href);
            
            setTimeout(() => {
              isScrolling = false;
            }, 1500);
          }
        });
      }
    });

    function updateActiveTOC() {
      if (isScrolling) return;
      
      let currentActive = null;
      const scrollTop = window.pageYOffset + 120;
      
      for (let i = tocItems.length - 1; i >= 0; i--) {
        const sectionId = tocItems[i].href.substring(1);
        const section = document.getElementById(sectionId);
        
        if (section && section.offsetTop <= scrollTop) {
          currentActive = tocLinks[i];
          break;
        }
      }
      
      if (!currentActive && tocLinks.length > 0) {
        currentActive = tocLinks[0];
      }
      
      tocLinks.forEach(link => link.classList.remove('active'));
      if (currentActive) {
        currentActive.classList.add('active');
      }
    }
    
    let ticking = false;
    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateActiveTOC();
          ticking = false;
        });
        ticking = true;
      }
    }
    
    window.addEventListener('scroll', requestTick);
    updateActiveTOC();
  }
});
</script>
