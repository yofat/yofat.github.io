---
layout: default
title: æœå°‹
permalink: /search.html
---

<div class="search-page">
  <div class="search-header">
    <h1>ğŸ” æœå°‹æ–‡ç« </h1>
    <p class="search-subtitle">åœ¨æ‰€æœ‰æ–‡ç« ä¸­æœå°‹é—œéµå­—ã€æ¨™ç±¤æˆ–åˆ†é¡</p>
  </div>

  <div class="search-container">
    <div class="search-input-wrapper">
      <input 
        id="search-input" 
        type="search" 
        placeholder="è¼¸å…¥é—œéµå­—ã€æ¨™é¡Œæˆ–æ¨™ç±¤..." 
        aria-label="Search"
        autocomplete="off"
      />
      <div class="search-icon">ğŸ”</div>
      <div id="search-clear" class="search-clear" title="æ¸…é™¤æœå°‹">âœ•</div>
    </div>
    
    <div class="search-stats">
      <span id="search-count">è¼¸å…¥é—œéµå­—é–‹å§‹æœå°‹</span>
    </div>
  </div>

  <div id="search-results" class="search-results" role="list"></div>

  <div class="search-tips">
    <h3>ğŸ’¡ æœå°‹å°æŠ€å·§</h3>
    <ul>
      <li>ä½¿ç”¨ç©ºæ ¼åˆ†éš”å¤šå€‹é—œéµå­—</li>
      <li>æœå°‹æœƒåŒ…å«æ¨™é¡Œã€å…§å®¹ã€æ¨™ç±¤å’Œåˆ†é¡</li>
      <li>ä¸å€åˆ†å¤§å°å¯«</li>
      <li>è©¦è©¦æœå°‹ "Jekyll"ã€"Python"ã€"è³‡æ–™ç§‘å­¸" ç­‰é—œéµå­—</li>
    </ul>
  </div>

  <div class="search-shortcuts">
    <h4>ğŸ·ï¸ å¿«é€Ÿæœå°‹</h4>
    <div class="tag-shortcuts">
      <button class="shortcut-btn" data-query="Jekyll">Jekyll</button>
      <button class="shortcut-btn" data-query="Python">Python</button>
      <button class="shortcut-btn" data-query="è³‡æ–™ç§‘å­¸">è³‡æ–™ç§‘å­¸</button>
      <button class="shortcut-btn" data-query="äººå·¥æ™ºèƒ½">AI</button>
      <button class="shortcut-btn" data-query="æŠ€è¡“">æŠ€è¡“</button>
      <button class="shortcut-btn" data-query="æ•™å­¸">æ•™å­¸</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const input = document.getElementById('search-input');
  const results = document.getElementById('search-results');

  const res = await fetch('{{ "/search.json" | relative_url }}', { cache: 'force-cache' });
  const data = await res.json();

  const idx = lunr(function () {
    this.ref('url');
    this.field('title');
    this.field('content');
    this.field('categories');
    this.field('tags');
    data.forEach(doc => this.add(doc));
  });

  function highlightText(text, query) {
    if (!query) return text;
    const regex = new RegExp(`(${query.split(' ').join('|')})`, 'gi');
    return text.replace(regex, '<span class="search-highlight">$1</span>');
  }

  function render(items, query = '') {
    const searchCount = document.getElementById('search-count');
    results.innerHTML = '';
    results.classList.remove('search-loading');
    
    if (query && items.length > 0) {
      searchCount.textContent = `æ‰¾åˆ° ${items.length} ç¯‡ç›¸é—œæ–‡ç« `;
    } else if (query && items.length === 0) {
      searchCount.textContent = 'æ²’æœ‰æ‰¾åˆ°ç›¸é—œæ–‡ç« ';
    } else {
      searchCount.textContent = 'è¼¸å…¥é—œéµå­—é–‹å§‹æœå°‹';
    }
    
    items.forEach((item, index) => {
      const doc = data.find(d => d.url === item.ref);
      
      const article = document.createElement('article');
      article.className = 'search-result-item';
      article.style.animationDelay = `${index * 0.1}s`;
      
      const title = document.createElement('h3');
      const titleLink = document.createElement('a');
      titleLink.href = doc.url;
      titleLink.innerHTML = highlightText(doc.title, query);
      title.appendChild(titleLink);
      
      const meta = document.createElement('div');
      meta.className = 'search-meta';
      
      const date = document.createElement('span');
      date.className = 'search-date';
      date.textContent = doc.date;
      
      const categories = document.createElement('span');
      categories.className = 'search-categories';
      if (doc.categories && doc.categories.length > 0) {
        categories.innerHTML = doc.categories.map(cat => 
          `<span class="category-tag">${cat}</span>`
        ).join('');
      }
      
      const tags = document.createElement('span');
      tags.className = 'search-tags';
      if (doc.tags && doc.tags.length > 0) {
        tags.innerHTML = doc.tags.map(tag => 
          `<span class="tag-item">#${tag}</span>`
        ).join('');
      }
      
      meta.appendChild(date);
      if (categories.innerHTML) meta.appendChild(categories);
      if (tags.innerHTML) meta.appendChild(tags);
      
      const excerpt = document.createElement('p');
      excerpt.className = 'search-excerpt';
      const excerptText = doc.content ? doc.content.substring(0, 150) + '...' : '';
      excerpt.innerHTML = highlightText(excerptText, query);
      
      article.appendChild(title);
      article.appendChild(meta);
      article.appendChild(excerpt);
      
      results.appendChild(article);
    });
    
    if (query && items.length === 0) {
      const noResults = document.createElement('div');
      noResults.className = 'no-results';
      noResults.innerHTML = `
        <div class="no-results-icon">ğŸ“­</div>
        <p>æ‰¾ä¸åˆ°åŒ…å«ã€Œ<strong>${query}</strong>ã€çš„æ–‡ç« </p>
        <p class="muted">è©¦è©¦å…¶ä»–é—œéµå­—æˆ–æª¢æŸ¥æ‹¼å¯«</p>
      `;
      results.appendChild(noResults);
    }
  }

  const clearBtn = document.getElementById('search-clear');
  
  function performSearch() {
    const q = input.value.trim();
    if (!q) {
      render([], '');
      clearBtn.style.display = 'none';
      return;
    }
    
    clearBtn.style.display = 'block';
    
    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    results.classList.add('search-loading');
    document.getElementById('search-count').textContent = 'æœå°‹ä¸­...';
    
    // ä½¿ç”¨ setTimeout è®“ UI æœ‰æ™‚é–“æ›´æ–°
    setTimeout(() => {
      try {
        const items = idx.search(lunr.utils.asString(q));
        render(items, q);
      } catch (e) {
        render([], q); // ç„¡æ•ˆèªæ³•ä¿è­·
      }
    }, 100);
  }
  
  input.addEventListener('input', performSearch);
  
  clearBtn.addEventListener('click', () => {
    input.value = '';
    input.focus();
    performSearch();
  });
  
  // å¿«é€Ÿæœå°‹æŒ‰éˆ•
  const shortcutBtns = document.querySelectorAll('.shortcut-btn');
  shortcutBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const query = btn.dataset.query;
      input.value = query;
      input.focus();
      performSearch();
      // æ»¾å‹•åˆ°çµæœå€åŸŸ
      document.getElementById('search-results').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start' 
      });
    });
  });
  
  // éµç›¤å¿«æ·éµ
  document.addEventListener('keydown', (e) => {
    // Ctrl/Cmd + K èšç„¦æœå°‹æ¡†
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      input.focus();
    }
    
    // ESC æ¸…é™¤æœå°‹
    if (e.key === 'Escape' && document.activeElement === input) {
      input.value = '';
      performSearch();
    }
  });
  
  // æ·»åŠ å¿«æ·éµæç¤ºåˆ° placeholder
  input.placeholder = 'è¼¸å…¥é—œéµå­—æœå°‹... (Ctrl+K)';
  
  // åˆå§‹åŒ–æ™‚éš±è—æ¸…é™¤æŒ‰éˆ•
  clearBtn.style.display = 'none';
  
  // é é¢è¼‰å…¥å®Œæˆå¾Œè‡ªå‹•èšç„¦æœå°‹æ¡†
  input.focus();
});
</script>
